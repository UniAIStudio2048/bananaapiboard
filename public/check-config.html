<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>é…ç½®æ£€æŸ¥</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .box { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h1>ğŸ” ç³»ç»Ÿé…ç½®æ£€æŸ¥</h1>
  
  <div id="results"></div>
  
  <button onclick="checkAll()">ğŸ”„ é‡æ–°æ£€æŸ¥</button>
  <button onclick="initConfig()">âš™ï¸ åˆå§‹åŒ–é…ç½®</button>
  <button onclick="clearStorage()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>

  <script>
    function checkAll() {
      const results = document.getElementById('results');
      results.innerHTML = '';
      
      // 1. æ£€æŸ¥ system_config
      const systemConfig = localStorage.getItem('system_config');
      if (systemConfig) {
        try {
          const config = JSON.parse(systemConfig);
          results.innerHTML += `
            <div class="box success">
              <h3>âœ… system_config å·²é…ç½®</h3>
              <pre>${JSON.stringify(config, null, 2)}</pre>
            </div>
          `;
        } catch (e) {
          results.innerHTML += `
            <div class="box error">
              <h3>âŒ system_config æ ¼å¼é”™è¯¯</h3>
              <p>${e.message}</p>
            </div>
          `;
        }
      } else {
        results.innerHTML += `
          <div class="box warning">
            <h3>âš ï¸ system_config æœªé…ç½®</h3>
            <p>è¯·ç‚¹å‡»ã€Œåˆå§‹åŒ–é…ç½®ã€æŒ‰é’®</p>
          </div>
        `;
      }
      
      // 2. æ£€æŸ¥ token
      const token = localStorage.getItem('token');
      if (token) {
        results.innerHTML += `
          <div class="box success">
            <h3>âœ… Token å·²å­˜åœ¨</h3>
            <p>${token.substring(0, 30)}...</p>
          </div>
        `;
      } else {
        results.innerHTML += `
          <div class="box warning">
            <h3>âš ï¸ æœªç™»å½•</h3>
            <p>è¯·å…ˆç™»å½•</p>
          </div>
        `;
      }
      
      // 3. æµ‹è¯• API
      testAPI();
    }
    
    async function testAPI() {
      const results = document.getElementById('results');
      const token = localStorage.getItem('token');
      
      if (!token) {
        results.innerHTML += `
          <div class="box warning">
            <h3>âš ï¸ è·³è¿‡ API æµ‹è¯•</h3>
            <p>éœ€è¦å…ˆç™»å½•</p>
          </div>
        `;
        return;
      }
      
      try {
        const systemConfig = JSON.parse(localStorage.getItem('system_config') || '{}');
        const headers = {
          'Authorization': `Bearer ${token}`,
          'X-Tenant-ID': systemConfig.tenantId || 'default-tenant-001',
          'X-Tenant-Key': systemConfig.tenantKey || 'DEFAULT-LICENSE-KEY-001'
        };
        
        results.innerHTML += `
          <div class="box">
            <h3>ğŸ”„ æ­£åœ¨æµ‹è¯• API...</h3>
            <p>è¯·æ±‚å¤´ï¼š</p>
            <pre>${JSON.stringify(headers, null, 2)}</pre>
          </div>
        `;
        
        const response = await fetch('/api/admin/license-config', {
          method: 'GET',
          headers: headers
        });
        
        const data = await response.json();
        
        if (response.ok) {
          results.innerHTML += `
            <div class="box success">
              <h3>âœ… API æµ‹è¯•æˆåŠŸ</h3>
              <p>çŠ¶æ€ç : ${response.status}</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        } else {
          results.innerHTML += `
            <div class="box error">
              <h3>âŒ API æµ‹è¯•å¤±è´¥</h3>
              <p>çŠ¶æ€ç : ${response.status}</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        }
      } catch (e) {
        results.innerHTML += `
          <div class="box error">
            <h3>âŒ API è¯·æ±‚å¤±è´¥</h3>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
    
    function initConfig() {
      const defaultConfig = {
        tenantId: 'default-tenant-001',
        tenantKey: 'DEFAULT-LICENSE-KEY-001',
        brandName: 'é¦™è•‰AI',
        primaryColor: '#FBBF24'
      };
      localStorage.setItem('system_config', JSON.stringify(defaultConfig));
      alert('âœ… é…ç½®å·²åˆå§‹åŒ–ï¼');
      checkAll();
    }
    
    function clearStorage() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜å—ï¼Ÿï¼ˆéœ€è¦é‡æ–°ç™»å½•ï¼‰')) {
        localStorage.clear();
        alert('âœ… ç¼“å­˜å·²æ¸…é™¤ï¼');
        checkAll();
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.onload = checkAll;
  </script>
</body>
</html>

